angular.module("fieldSetting",[]).controller("setting",["$scope","$filter",function(n,t){n.templates=[{Name:"SingleLine",DisplayName:"单行文本",Description:"",Placeholder:"",Size:2,Required:!0},{Name:"Paragraph",DisplayName:"多行文本",Description:"",Placeholder:"",Size:2,Required:!1},{Name:"Date",DisplayName:"日期",Description:"",Size:2,Required:!1},{Name:"Radio",DisplayName:"单选",Description:"",Required:!1,DefaultSelect:{},FieldOptions:[{DisplayText:"选项1",Value:""},{DisplayText:"选项2",Value:""}]},{Name:"Checkbox",DisplayName:"多选",Description:"",Format:1,Required:!1,DefaultSelect:{},FieldOptions:[{DisplayText:"选项1",Value:""},{DisplayText:"选项2",Value:""}]},{Name:"Dropdown",DisplayName:"下拉选项",Description:"",Size:2,Format:1,Required:!1,DefaultSelect:{},FieldOptions:[{DisplayText:"选项1",Value:""},{DisplayText:"选项2",Value:""}]}];(n.Fields==null||n.Fields.length==0)&&(n.Fields=[angular.copy(n.templates[0])]);n.fieldInfo=n.Fields[0];n.editTemplate=function(t){n.fieldInfo=t};n.setFieldWidth=function(n,t){n.Style={width:t}};n.setDefaultOption=function(n,t){for(var i=0;i<n.FieldOptions.length;i++)n.FieldOptions[i].DefaultSelected=!1;t.DefaultSelected=!0;n.DefaultSelect=t};n.removeField=function(t){n.Fields=n.Fields.filter(function(n){return n!=t})};n.removeOption=function(n,t){for(var r=0,i=0;i<n.length;i++)n[i]==t&&(r=i);n.splice(r,1)};n.addOption=function(n){n.push({DisplayText:"",Value:"",DefaultSelected:!1})};var i=t("orderBy");n.sortOptions=function(n,t){n=i(n,"DisplayText",t);for(var r=0;r<n.length;r++)n[r].Order=r+1};n.showOptionValue=function(n,t){n.ShowValue=t;for(var i=0;i<n.FieldOptions.length;i++)n.FieldOptions[i].Value||(n.FieldOptions[i].Value=n.FieldOptions[i].DisplayText)};n.dragOver=function(t){for(var r=0,i=0;i<t.currentTarget.parentNode.children.length;i++)if(t.currentTarget===t.currentTarget.parentNode.children[i]){r=i;break}n.Fields[r].onDrop=!0;n.$apply();t.preventDefault()};n.dragLeave=function(t){for(var r=0,i=0;i<t.currentTarget.parentNode.children.length;i++)if(t.currentTarget===t.currentTarget.parentNode.children[i]){r=i;break}n.Fields[r].onDrop=!1;n.$apply();t.preventDefault()};n.drag=function(n){n.dataTransfer.setData("Field",n.target.id)};n.drop=function(t){var u,r,i;for(t.preventDefault(),u=t.dataTransfer.getData("Field"),r=0,i=0;i<t.currentTarget.parentNode.children.length;i++)if(t.currentTarget===t.currentTarget.parentNode.children[i]){r=i;break}for(n.Fields[r].onDrop=!1,i=0;i<n.templates.length;i++)u==n.templates[i].Name&&n.Fields.splice(r+1,0,angular.copy(n.templates[i]));n.$apply()};n.save=function(){if(!$.trim(n.Title)){n.Message="请输入这个表单的名称";return}Easy.Block();$.ajax({type:"POST",dataType:"json",url:n.saveUrl,data:JSON.stringify({ID:n.ID,Title:n.Title,Description:n.Description,FormFields:n.Fields}),contentType:"application/json; charset=utf-8",async:!0,success:function(t){t.Message?(n.Message=t.Message,n.$apply()):window.location.href="/Admin/Form"}})}}]);
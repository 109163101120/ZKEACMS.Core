/*!
 * http://www.zkea.net/
 * Copyright 2016 ZKEASOFT
 * http://www.zkea.net/licenses
 */
tinymce.PluginManager.add("filebrowser",function(n){function t(){window.top.Easy.ShowUrlWindow({url:"/admin/Media/MultiSelect",width:1024,height:600,title:"媒体库",onLoad:function(t){var r=this;window.top.$(this.document).find("#confirm").click(function(){t.close()});window.top.$(this.document).on("click",".confirm",function(){var r=i({src:$(this).data("result"),name:$(this).data("name")});r.ele&&(n.undoManager.transact(function(){n.selection.setContent(n.dom.createHTML(r.ele,r.attr,r.innerText))}),n.focus(),n.nodeChanged());t.close()});window.top.$(this.document).on("click",".confirm-multi-select",function(){$(".multi-select:not(.unchecked)",$(this).closest("body")).each(function(){var t=i({src:$(this).data("result"),name:$(this).data("name")});t.ele&&n.undoManager.transact(function(){n.selection.setContent(n.dom.createHTML(t.ele,t.attr,t.innerText))})});n.focus();n.nodeChanged();t.close()})}})}function i(n){var r=n.src,i=n.name,t={ele:"",attr:{},innerText:""},u=r.toLowerCase();return/.*(\.jpg|\.gif|\.png|\.jpeg|\.bmp|\.jpe)$/.test(u)?(t.ele="img",t.attr={src:r,title:i,alt:i}):/.*(\.mp4)$/.test(u)?(t.ele="video",t.attr={controls:"controls",src:r,title:i}):(t.ele="a",t.attr={href:r,"class":"btn btn-default",download:i,title:i},t.innerText="下载"),t}n.addCommand("filebrowser",t);n.addButton("filebrowser",{icon:"browse",tooltip:"媒体库",onclick:t});n.addMenuItem("filebrowser",{icon:"browse",text:"媒体库",onclick:t,context:"insert",prependToContext:!0})});